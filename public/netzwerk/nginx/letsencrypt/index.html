<!DOCTYPE html>
<html>
  <head>
    <title>Meine Hugo Seite</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.49.2" />

<title>Let´s Encrypt :: Meine Hugo Seite</title>
<link rel="shortcut icon" href="../../../images/favicon.png" type="image/x-icon" />
<link href="../../../css/nucleus.css" rel="stylesheet">
<link href="../../../css/font-awesome.min.css" rel="stylesheet">
<link href="../../../css/hybrid.css" rel="stylesheet">
<link href="../../../css/featherlight.min.css" rel="stylesheet">
<link href="../../../css/auto-complete.css" rel="stylesheet">
<link href="../../../theme-original/style.css" rel="stylesheet">

<link rel="stylesheet" href="../../../css/bootstrap.min.css">
<script src="../../../js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<meta name="description" content="Mit Let´s Encrypt ein Zertifikat erstellen">


    
  </head>
  <body data-url="/netzwerk/nginx/letsencrypt/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="showVisitedLinks">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <p>Blume Dokumentation</p>

  

    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="../../../js/lunr.min.js"></script>
		<script type="text/javascript" src="../../../js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "\/";
        
		</script>
		<script type="text/javascript" src="../../../js/search.js"></script>
  </div>

      <ul class="topics">
            <li data-nav-id="/" class="dd-item">
            <a href="../../../"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="/netzwerk/" class="dd-item parent haschildren
        ">
      <div>
      <a href="../../../netzwerk/">IT-Struktur</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/netzwerk/fritzbox/" class="dd-item">
        <div>
          <a href="../../../netzwerk/fritzbox/">
            FritzBox
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
    <li data-nav-id="/netzwerk/nginx/" class="dd-item parent haschildren
        ">
      <div>
      <a href="../../../netzwerk/nginx/">Revers-Proxy</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/netzwerk/nginx/letsencrypt/" class="dd-item active">
        <div>
          <a href="../../../netzwerk/nginx/letsencrypt/">
            Let´s Encrypt
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/netzwerk/nginx/servername/" class="dd-item">
        <div>
          <a href="../../../netzwerk/nginx/servername/">
            Server Ports und Namen
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/netzwerk/nginx/location/" class="dd-item">
        <div>
          <a href="../../../netzwerk/nginx/location/">
            Server Unterodrner (locations)
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/netzwerk/nginx/proxy/" class="dd-item">
        <div>
          <a href="../../../netzwerk/nginx/proxy/">
            HTTP Proxy
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/netzwerk/nginx/gitlab_domain_subfolder/" class="dd-item">
        <div>
          <a href="../../../netzwerk/nginx/gitlab_domain_subfolder/">
            GitLab hinter nginx-Revers-Proxy
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/netzwerk/webserver/" class="dd-item
        ">
      <div>
      <a href="../../../netzwerk/webserver/">WebServer</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docker/" class="dd-item haschildren
        ">
      <div>
      <a href="../../../docker/">docker</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docker/rpi_install_docker/" class="dd-item">
        <div>
          <a href="../../../docker/rpi_install_docker/">
            Installation
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/docker/rpi_install_compose/" class="dd-item">
        <div>
          <a href="../../../docker/rpi_install_compose/">
            Installation docker-compose
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/docker/swarm/" class="dd-item">
        <div>
          <a href="../../../docker/swarm/">
            swarm
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/docker/cluster/" class="dd-item">
        <div>
          <a href="../../../docker/cluster/">
            cluster
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
    <li data-nav-id="/docker/container/" class="dd-item haschildren
        ">
      <div>
      <a href="../../../docker/container/">container</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docker/container/rpi-hugo/" class="dd-item">
        <div>
          <a href="../../../docker/container/rpi-hugo/">
            rpi-hugo
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/docker/container/certbot/" class="dd-item">
        <div>
          <a href="../../../docker/container/certbot/">
            certbot-rpi
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/docker/container/pi-hole/" class="dd-item">
        <div>
          <a href="../../../docker/container/pi-hole/">
            pi-hole
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/rpi/" class="dd-item haschildren
        ">
      <div>
      <a href="../../../rpi/">Raspberry Pi</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/rpi/configuration/" class="dd-item">
        <div>
          <a href="../../../rpi/configuration/">
            Rpi einrichten
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/rpi/ssh_key/" class="dd-item">
        <div>
          <a href="../../../rpi/ssh_key/">
            SSH und keys
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/rpi/rpimonitor/" class="dd-item">
        <div>
          <a href="../../../rpi/rpimonitor/">
            RPi-Monitor
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/rpi/tricks/" class="dd-item">
        <div>
          <a href="../../../rpi/tricks/">
            tricks
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>



        <section id="shortcuts">
                <li class="" role=""><h3>More</h3><a href="https://github.com/Grembold/myHugoLP" target="_blank" rel="noopener"><i class='fa fa-github'></i> Github repo</a></li>
                <li class="" role=""><a href="http://docdock.netlify.com/" target="_blank" rel="noopener"><i class='fa fa-bookmark'></i> Docdock Documentation</a></li>
                <li class="" role=""><a href="../../../impressum/" target="_blank" rel="noopener"><i class='fa fa-bullhorn'></i> Impressum</a></li>
                <li class="" role=""><a href="../../../links/" target="_blank" rel="noopener"><i class='fa fa-external-link-square'></i> Links</a></li>
        </section>
            <a id="clear-history" class="" href="#" data-clear-history-toggle=""><i class="fa  fa-history"></i> </a>

    <hr />
    <li></li>
    
    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    
      
      
      
    <div id="top-github-link">
      <a class="github-link" href="https://github.com/Grembold/myHugoLP/edit/master/content/netzwerk/nginx/letsencrypt.md" target="blank">
        <i class="fa fa-code-fork"></i>
        
      </a>
    </div><div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        










 <a href='../../../'>DocDock für Blume</a> > <a href='../../../netzwerk/'>IT-Struktur</a> > <a href='../../../netzwerk/nginx/'>Revers-Proxy</a> > Let´s Encrypt

 

 

 

   
        </span>
    </div>
    
    
    <div class="progress">
        <div class="wrapper">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#certbot-installieren">certbot installieren</a></li>
<li><a href="#let-s-encrypt-zertifikate-für-nginx-installieren">Let´s Encrypt Zertifikate für nginx installieren</a></li>
<li><a href="#zertifikat-und-konfiguration-testen">Zertifikat und Konfiguration testen</a></li>
<li><a href="#zertifikate-automatisch-erneuern-lassen">Zertifikate automatisch erneuern lassen</a></li>
<li><a href="#zertifikate-sichern">Zertifikate sichern</a></li>
<li><a href="#quellen">Quellen</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Let´s Encrypt</h1>
  



    
    
    
    

<h3 id="certbot-installieren">certbot installieren</h3>

<p>Wie das Docker image installiert wird habe ich bereits [hier]/docker/container/certbot/ beschrieben. Nun geht es darum ein Zertifikat für die eigene Domain zu erhalten.</p>

<h3 id="let-s-encrypt-zertifikate-für-nginx-installieren">Let´s Encrypt Zertifikate für nginx installieren</h3>

<div class="alert 
alert-warning"
 
role="alert">Erst wenn Sie sicher sind, dass alles klappt, entfernen Sie zuletzt die Option &ndash;staging und wiederholen das Kommando nochmals zur Installation der endgültigen Zertifikate.</div>


<p>Das Abrufen der Zertifikate läuft folgender massen ab:
* Der eigene Webserver läuft und ist unter meineDomain:80 erreichbar.
* Certbot erstell im www-Verzeichnis des Servers einen versteckten Ordner <code>.well-known</code> und einige Dateien
* certbot prüft bei Let´s Encrypt, ob diese Dateien erreichbar sind.
* ist dies erfolgreich, wird das Zertifikat unter <code>/etc/letsencrypt/meineDomain</code>abgelegt.</p>

<p>Damit dies nun über das Docker Image funktioniert, müssen wir diesem zwei Verzeichnisse mitgeben. Das erste ist das WWW-Verzeichnis vom Webserver und das zweite ein Verzeichnis, indem der certbot die erstellten Zertifikate ablegen kann.</p>

<pre><code>docker run --rm -v $CERTS_DIR:/etc/letsencrypt -p 80:80 --name certbot napnap75/rpi-certbot:latest certbot certonly --standalone --standalone-supported-challenges http-01 -t -n --agree-tos -m $EMAIL -d $HOST
</code></pre>

<p>Startet den certbot im &ldquo;interaktiven&rdquo; modus</p>

<pre><code>docker run -it --rm \
-v /home/pi/magic-broccoli/public:/var/www/ \
-v /home/pi/nginx-proxy/certs:/etc/letsencrypt --name certbot bcecchinato/certbot-rpi \
certonly --webroot -w /var/www/ -d blume.goip.de -d www.blume.goip.de -d doc.blume.goip.de
</code></pre>

<h3 id="zertifikat-und-konfiguration-testen">Zertifikat und Konfiguration testen</h3>

<p>HTTPS-Konfiguration noch über die Seite <a href="https://www.ssllabs.com">https://www.ssllabs.com</a> prüfen lassen.</p>

<h3 id="zertifikate-automatisch-erneuern-lassen">Zertifikate automatisch erneuern lassen</h3>

<pre><code>&quot;Volumes&quot;: {
            &quot;/etc/letsencrypt&quot;: {},
            &quot;/sys/fs/cgroup&quot;: {},
            &quot;/var/lib/letsencrypt&quot;: {}
</code></pre>

<h3 id="zertifikate-sichern">Zertifikate sichern</h3>

<p>Nun hat man es endlich geschafft und hält die eigenen TLS-Zertifikate in der Hand &hellip; naja im Ordner. Doch Wo legt man diese hin, damit sie nicht verloren gehen. Sicher man kann sich ja jetzt jeder Zeit wieder neue machen und spätestens nach 3 Monaten ist dies auch nötig, doch möchte man das ein kleines <code>certbot renew</code>reicht und man nicht alles von vorn machen muss.
Der Certbot hat alles nötige in ein Verzeichnis gepackt, dies müssten wir nur noch zippen und fertig, &hellip; doch ganz so leicht ist es dann doch nicht.
Die Zertifikate und ordner sind nur für den root lesbar und sollten es auch bleiben. Mit einem einfachen Zip würden die Benutzerrechte verloren gehen. Daher muss das Verzeichnis zunächst mit tar als eine Datei zusammenfasst werden und kann handlich komprimiert werden.</p>

<pre><code>sudo tar cf - certs/ | 7z a -si blume.goip.de.cert.20170908.7z
</code></pre>

<p>Das Entpacken eines solchen Archives läuft dann wieder in umgekehrter Reihenfolge ab (<code>Achtung</code>: Das Zielverzeichnis ZIELPFAD muss vorhanden sein!):</p>

<pre><code>sudo 7za x -so ERGEBNIS.tar.7z | tar xf - -C ZIELPFAD --numeric-owner
</code></pre>

<h3 id="quellen">Quellen</h3>

<ul>
<li><a href="https://letsencrypt.org/">https://letsencrypt.org/</a></li>
<li><a href="https://certbot.eff.org/docs">https://certbot.eff.org/docs</a></li>
<li><a href="https://certbot.eff.org/#debianjessie-nginx">https://certbot.eff.org/#debianjessie-nginx</a></li>
<li><a href="https://kofler.info/lets-encrypt-zertifikate-fuer-web-und-mail-unter-ubuntu-16-04/">https://kofler.info/lets-encrypt-zertifikate-fuer-web-und-mail-unter-ubuntu-16-04/</a></li>
<li><a href="https://blog.doenselmann.com/nginx-und-lets-encrypt-auf-raspberry-pi/">https://blog.doenselmann.com/nginx-und-lets-encrypt-auf-raspberry-pi/</a></li>
</ul>


    
    
          <footer class=" footline" >
	
	    <i class='fa fa-user'></i> <a href="mailto:olaf-petersen@gmx.com">Olaf Blume</a>  <i class='fa fa-calendar'></i> 06/09/2017
	    </div>
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="../../../netzwerk/nginx/" title="Revers-Proxy"> <i class="fa fa-chevron-left"></i><label>Revers-Proxy</label></a>
    <a class="nav nav-next" href="../../../netzwerk/nginx/servername/" title="Server Ports und Namen" style="margin-right: 0px;"><label>Server Ports und Namen</label><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="../../../js/clipboard.min.js"></script>
<script src="../../../js/featherlight.min.js"></script>
<script src="../../../js/html5shiv-printshiv.min.js"></script>

<script src="../../../js/modernizr.custom.71422.js"></script>
<script src="../../../js/docdock.js"></script>
<script src="../../../theme-original/script.js"></script>


    

    
    

    
  </body>
</html>